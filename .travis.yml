language:
- java

before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"

# disable the default submodule logic
git:
  submodules: false

env: 
  - TERM=dumb

# get current remote HEAD of submodules
# adjust hale to use local platform
before_install:
  - git submodule update --init --recursive --remote
  - sed -i "s#https://gitlab.wetransform.to/hale/hale-build-support/raw/.*/updatesites/platform#file:$TRAVIS_BUILD_DIR/hale-platform/build/updatesite#" hale/platform/hale-platform.target
  - sed -i "s#<unit id=\"eu.esdihumboldt.hale.platform.feature.group\" version=\".*\"/>#<unit id=\"eu.esdihumboldt.hale.platform.feature.group\" version=\"0.0.0\"/>#" hale/platform/hale-platform.target
  - sed -i "s#repositories {#repositories {\\nmaven { url 'https://repo.boundlessgeo.com/main/'}#" hale-platform/build.gradle
  - echo "platform{eclipseMirror='http://dl.bintray.com/simon-scholz/eclipse-apps/eclipse-p2-minimal.tar.gz'}" >> hale-platform/build.gradle

# build updatesite  
install:
- cd hale-platform && ./gradlew --info --stacktrace updateSite

# build hale
script:
- cd ../hale && ./build.sh product --arch x86_64 --os linux HALE

deploy:
  provider: bintray
  file: ".bintray.json"
  user: $BINTRAY_USER
  key: $BINTRAY_KEY
  skip_cleanup: true # to upload artifacts created during the build

BINTRAY_KEY:
  secure: D7j9ztuxLb3Cq7HKkL6fqGdsr6aLlVo9OfZa4Jon1AoqKIWZXQBbX79L2RkRTgaA3mmIGg4YCUBKfLfCi0FXsfu8kC4ojerr1oRoFYV57fdFCrHX0Xn+9cutO+rvQmuWv/SnTfT2VAKDSNGUyZY5bGkH7GR3chYTCqHX7SrL8q7aUjxXuUaFA6nnRF2MpYPEW04bddkkJFZZHkL5Cgnntq4ixnVruJeXIO5iS5l1sNgBF5aZay47DsrHTglX/sPr8f3vvByveG5X2NLIRb4rBdUP3xW8xiyyoWqyGE6TIvOMfoh7ueckL1n0nbxX2FVh9qS6EQl24DBP/BOW5raTXcTKcMiLkqdf32DucCyMkeE5rtjvnYWKt4qjjbekD469rkbTUdgQKOgdH/UTUKmfootbkOfYw8rXM7Dlj8X7DC95BRlMqZ8NLvhXCGoJmigsBLS8u6C3BNRn283BjUVZxzAqO8xTbrKqYFFOeqvwXx3wQPS/KAGZQQwZZMe4j8rbYS9W05+DW73bDJ24oBn5gjRZf8jvDX1V3pLx5G80H6x203x+SiaCygKz/NoeFz29f1DV8+VamSBUVzNNNPsv1G14OV81J9b20ZY098ITUfQW+O6E+GFOE4/HsBKHoDK0oz4t5KEyxzWoPvoCOumZlJD4sd6iDVw2F4N+58K2ssA=
BINTRAY_USER:
  secure: CrgKxgCIQ8BItXkJ1D/PQKI8D2NY+2cRaYXiG6C4mzo+9cLRFpAZQH/UlmlI3lbSV86v7bgNX0Azds3pCXAsEWAFRUnBIFuQmSL6/DqHGceADWVD9nH7jCKWO7MJtVwhktpfQfPYAsv1YiCqL2KZb9dDsEHoVYmYeqZzYq2VobUIDPFroDnsMlXO/Z/qGinlV/lvF+R3DOi288AfdGTRgqZtZB6bRw85ysf55pK0PzMRq23/xwu8l0ORO4zf26kdHkPb0Zo0E62HIRxZgmsDEOCUw6dmW07jaV2FKWNIWN1bCtqXHSwe9S7v3j7d1pUM9Wknfs+28hzI8JopSw1ogs2y8v/x1j1kGVPqgJIlwRc7Yi/1QI950hq/JbOrrqrsav0XdHkN7Kn0Mpil/umVuysUX3pndfh6U3bMjnvzkSPncDtTGi6OSECsr4LGcK38NFJI86kUr5fgYRHxeFA0RQnOxXPtH5Yy0ON29Um1DcW+JTL9+5uL4qbteZ9NLbhS72vcZJ0ob6lfT3yPXFmJJxO1tMVLRVJnSFrlK8VPs/tM8/tc5si7nKVVQP+j+rW86ykQTN86UQ5EOnFs0xFHHHoWMkYDUCLkzFpZy+DYk+iKawsSyCqS9d9h2HSo9FzDfrWYR5Y0z6Hs4z0Tz4q/26uMgftaE96kOSlj0OLR0Js=
